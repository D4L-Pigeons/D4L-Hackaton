chain:
- chain_link_spec_path: "misc/batch_rearranger"
  name: "br-0"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "b 1 h w -> b (h w)", kwargs: {}}]
- chain_link_spec_path: "blocks/block_stack"
  name: "bs-0"
  cfg:
    data_name: "img"
    input_dim: 784
    output_dim: 2
    hidden_dims: [512]
    ordered_module_specs:
    - {nnmodule_spec_path: "norm/batch", kwargs: {}}
    - {nnmodule_spec_path: "activation/relu", kwargs: {}}
    block_wrapper_name: null
- chain_link_spec_path: "condition_embedding/condition_embedding_transformer"
  name: "cet"
  cfg:
    cond_ids_name: "condition_token_ids"
    cat_ids_name: "condition_values"
    cond_embed_name: "condition_embedding"
    embedding_dim: 16
    transformer: {encoder_kwargs: {num_layers: 2}, encoder_layer_kwargs: {nhead: 2, dim_feedforward: 32}}
    embedding_module: {n_conditions: 4, n_categories_per_condition: [10, 2, 3, 2]}
- chain_link_spec_path: "blocks/block_stack"
  name: "bs-1"
  cfg:
    data_name: "condition_embedding"
    input_dim: 16
    output_dim: 16
    hidden_dims: [32]
    ordered_module_specs:
    - {nnmodule_spec_path: "activation/relu", kwargs: {}}
    block_wrapper_name: null
- chain_link_spec_path: "misc/batch_rearranger"
  name: "br-1"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "b d -> b 1 d", kwargs: {}}]
- chain_link_spec_path: "latent/prior_vec_conditioned_logits_gaussian_mixture_nll"
  name: "pvclgmn"
  cfg:
    data_name: "img"
    logits_name: "condition_embedding"
    n_components: 16
    latent_dim: 2
    components_std: 1.
    loss_coef_prior_nll: 1.
- chain_link_spec_path: "misc/batch_rearranger"
  name: "br-2"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "b 1 d -> b d", kwargs: {}}]
- chain_link_spec_path: "blocks/block_stack"
  name: "bs-2"
  cfg:
    input_dim: 2
    output_dim: 784
    hidden_dims: [512]
    ordered_module_specs:
    - {nnmodule_spec_path: "activation/relu", kwargs: {}}
    data_name: "img"
    block_wrapper_name: null
- chain_link_spec_path: "blocks/standalone_tiny_module"
  name: "oa"
  cfg:
    data_name: "img"
    nnmodule_spec_path: "activation/sigmoid"
    kwargs: {}
- chain_link_spec_path: "misc/batch_rearranger"
  name: "br-3"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "b (h w) -> b 1 1 h w", kwargs: {h: 28, w: 28}}]
- chain_link_spec_path: "misc/batch_rearranger"
  name: "command-br-0"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "b s d -> (b s) d", kwargs: {}}]
- chain_link_spec_path: "misc/batch_rearranger"
  name: "command-br-1-dynamic"
  cfg:
    rearrange_patterns: [{data_name: "img", pattern: "(b s) (h w) -> b s h w", kwargs: {h: 28, w: 28}}]
forward_link_order: ["br-0", "bs-0", "cet", "bs-1", "br-1", "pvclgmn", "br-2", "bs-2", "oa", "br-3"]
optimizer: {optimizer_name: "adam", kwargs: {}}
loss:
  loss_manager:
    loss_aggregator: "mean"
  reconstruction_loss_spec:
    nnmodulename: "mse"
    coef: 1.
    var_name: "img"
    kwargs: {}
processing_commands:
- command_name: 'sample_conditionally_from_prior'
  processing_spec:
    train: false
    steps:
    - {link_name: "cet", method_name: "forward", kwargs: {}}
    - {link_name: "bs-1", method_name: "forward", kwargs: {}}
    - {link_name: "pvclgmn", method_name: "sample", kwargs: {}}
    - {link_name: "command-br-0", method_name: "forward", kwargs: {}}
    - {link_name: "bs-2", method_name: "forward", kwargs: {}}
    - {link_name: "oa", method_name: "forward", kwargs: {}}
    - {link_name: "command-br-1-dynamic", method_name: "forward", kwargs: {}}
